# 画像削除機能 実装方針まとめ

## 要件
1. Turso（DB）からImageIdを削除
2. Cloudflareから画像を削除
3. md（Markdownデータ）内の該当画像URLの扱い

---

## md内画像URLの扱い方針

- **画像URL自体はmdから削除しない**
- 削除された画像は「画像は削除されました」などのプレースホルダーを表示する

### この方針のメリット
- mdの履歴や文脈が失われず、どこに画像があったか分かる
- 誤って画像を削除した場合も、どこに画像があったか復元しやすい
- 他のユーザーが同じmdを参照していても、リンク切れでレイアウトが崩れるのを防げる

---

## 実装イメージ

### 1. サーバーアクション
- クライアントから画像削除リクエスト（ImageId）をサーバーアクションに送信
- TursoからImageId削除
- Cloudflare APIで画像削除
- mdData自体は編集しない

### 2. API（/api/images/[imageId]）
- 画像がCloudflare/DBに存在しない場合、404ではなく「画像削除済み」用の画像やSVG、またはJSONで状態を返す

### 3. フロントエンド
- `<img onError={...} />` で画像取得失敗時に「画像は削除されました」画像やテキストを表示
- mdの内容はそのまま

---

## 検討ポイント
- 画像URLが複数回使われている場合も全て同様に対応
- 画像URLのMarkdown記法以外の記載パターンも考慮
- mdDataの更新は不要

---

## 結論
- mdの内容はそのまま、APIやフロントエンドで「削除済み」表示を制御する方針で進める
